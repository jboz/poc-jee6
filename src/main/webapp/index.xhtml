<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://java.sun.com/jsf/html" xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui">
<h:head>
	<meta charset="ISO-8859-1" />
	<title>POC JEE6</title>
</h:head>
<h:body>
	<h:link value="Go to partner page" outcome="partner.xhtml" />

	<h:form>
		<p:growl id="growl" showDetail="true" />

		<p:dataTable id="affairs" var="affair" value="#{cases}">
			<f:facet name="header">Affaires connues</f:facet>

			<p:column style="width:4%">
				<p:rowToggler />
			</p:column>

			<p:column style="width:48%">
				<f:facet name="header">Numéro affaire</f:facet>
				<h:outputText value="#{affair.id}" />
			</p:column>

			<p:column style="width:48%">
				<f:facet name="header">Date d'entrée en vigueur</f:facet>
				<h:outputText value="#{affair.effectDate}" />
			</p:column>

			<p:rowExpansion>
				<h:panelGrid id="display" columns="3" cellpadding="4" style="width:900px;" styleClass="ui-widget-content grid">
					<f:facet name="header">Assuré(s) de l'affaire :</f:facet>

					<h:panelGroup>
						<h:outputText value="Assuré A: " />
						<h:commandLink value="#{affair.ensuredA.partner.name}" action="partner.xhtml">
							<f:setPropertyActionListener target="#{partnerBean.partner}" value="#{affair.ensuredA.partner}" />
						</h:commandLink>
					</h:panelGroup>
					<h:outputText value="statut d'acceptation: #{affair.ensuredA.acceptation}" />
					<p:commandButton value="Statuer" action="affair.xhtml">
						<f:setPropertyActionListener target="#{affairBean.affair}" value="#{affair.ensuredA}" />
					</p:commandButton>

					<h:panelGroup rendered="#{affair.ensuredB != null}">
						<h:outputText value="Assuré B: " />
						<h:commandLink value="#{affair.ensuredB.partner.name}" action="partner.xhtml?faces-redirect=true" >
							<f:setPropertyActionListener target="#{partnerBean.partner}" value="#{affair.ensuredB.partner}" />
						</h:commandLink>
					</h:panelGroup>
					<h:outputText value="statut d'acceptation: #{affair.ensuredB.acceptation}" rendered="#{affair.ensuredB != null}" />
					<p:commandButton value="Statuer" action="affair" rendered="#{affair.ensuredB != null}">
						<f:setPropertyActionListener target="#{affairBean.affair}" value="#{affair.ensuredB}" />
					</p:commandButton>
				</h:panelGrid>
			</p:rowExpansion>
		</p:dataTable>
	</h:form>
</h:body>
</html>