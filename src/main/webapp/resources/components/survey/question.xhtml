<html xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://java.sun.com/jsf/html" xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets" xmlns:composite="http://java.sun.com/jsf/composite"
	xmlns:c="http://java.sun.com/jsp/jstl/core" xmlns:ice="http://www.icesoft.com/icefaces/component"
	xmlns:poc-survey="http://java.sun.com/jsf/composite/components/survey" xmlns:ace="http://www.icefaces.org/icefaces/components">

<head>
<title>(For validation only)</title>
</head>
<body>

	<composite:interface displayName="Question" shortDescription="Display a question.">
		<composite:attribute name="question" required="true" displayName="Question Bean" />
	</composite:interface>

	<composite:implementation>
		<ui:param name="key" value="survey.#{cc.attrs.question.finalCode}" />

		<ice:form id="form_#{cc.attrs.question.finalCode}" partialSubmit="true">
			<c:if test="#{cc.attrs.question.parent != null}">
				<ui:include src="include/simpleForm.xhtml">
					<ui:param name="question" value="#{question}" />
				</ui:include>
			</c:if>
			<c:if test="#{cc.attrs.question.parent == null}">
				<ice:panelCollapsible id="linkPanel" expanded="#{cc.attrs.question.mandatory}" styleClass="questionCollapsible">
					<!-- question mère -->
					<f:facet name="header">
						<ice:panelGroup>
							<ice:outputText id="question" value="#{msgs[key]}" />
							<!-- sélection si pas obligatoire -->
							<c:if test="#{!cc.attrs.question.mandatory}">
								<ice:selectOneRadio id="globalResponse" layout="spread" value="#{cc.attrs.question.firstResponse.value}"
									partialSubmit="true">
									<f:selectItem itemLabel="#{msgs['survey.oui']}" itemValue="#{true}" />
									<f:selectItem itemLabel="#{msgs['survey.non']}" itemValue="#{false}" />
								</ice:selectOneRadio>

								<ice:radio for="globalResponse" index="0" />
								<ice:radio for="globalResponse" index="1" />
							</c:if>
						</ice:panelGroup>
					</f:facet>
					<!-- 2 types de contenu. Un contenu fixe (simple formulaire) et un contenu répétable (table avec possibilité d'ajouter des lignes) -->

					<!-- plusieurs réponse sont possible, formulaire dans table -->
					<c:if test="#{cc.attrs.question.multiResponse}">
						<table>
							<tr>
								<c:forEach items="#{cc.attrs.question.subQuestions}" var="question">
									<th><h:outputText value="#{msgs['survey.'.concat(question.finalCode)]}" /></th>
								</c:forEach>
							</tr>
							<c:forEach end="#{cc.attrs.question.nbSubResponses}" varStatus="status">
								<tr>
									<ice:repeat value="#{cc.attrs.question.subQuestions}" var="subQuestion">
										<td>
											<!-- content response -->
											<ui:include src="include/simpleForm.xhtml">
												<ui:param name="response" value="#{subQuestion.getResponse(status.index)}" />
											</ui:include>
										</td>
									</ice:repeat>
									<td><h:outputText value="+" /></td>
								</tr>
							</c:forEach>
						</table>
					</c:if>

					<!-- formulaire simple, une seule réponse par sous question -->
					<c:if test="#{!cc.attrs.question.multiResponse}">
						<ice:repeat value="#{cc.attrs.question.subQuestions}" var="subQuestion" varStatus="status">
							<!-- single response -->
							<ui:include src="include/simpleForm.xhtml">
								<ui:param name="response" value="#{subQuestion.firstResponse}" />
							</ui:include>
						</ice:repeat>
					</c:if>
				</ice:panelCollapsible>
			</c:if>
		</ice:form>
	</composite:implementation>
</body>
</html>